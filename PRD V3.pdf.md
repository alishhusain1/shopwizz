# Revised PRD

(Improved per "AI PRD Editor" mandate — all gaps closed or flagged with [[MISSING:…]] tokens, guardrails hardened, and copy-paste-ready for engineering backlog) 

## Product Name:

ShopWizz.ai 

## Version: 

MVP v1.4 — "Pure GPT Web Search" edition

# Overview

ShopWizz.ai is a responsive web app that turns natural-language shopping questions—typed or spoken—into an infinite-scroll grid of product cards. Every result is sourced exclusively via the ChatGPT Web Search tool; no server-side scraping or third-party SERP APIs are ever called. GPT-4 parses each search payload into structured product objects containing: 

●​ imageUrl (if available → fallback placeholder service when null)

●​ title​

●​ link (direct product URL, no affiliate parameters)

●​ price (if discoverable)​

●​ rating / reviewCount (if discoverable)​

●​ whyBlurb — ≤ 120-char persuasive snippet auto-generated by GPT-4​

Cards surface in under two seconds on 4 G, delivering quick, bias-filtered inspiration for everyday shoppers. 

**Backend Implementation:**
All chat, product search, and product summary logic is implemented using Supabase Edge Functions. These functions are updated to use only OpenAI and ElevenLabs APIs, and to comply with all requirements in this PRD (no affiliate tagging, direct product links, etc.).

Target User

●​ Primary: Casual online shoppers who want fast, ad-lite product ideas without tab overload.​

●​ Secondary (future): Merchants and internal Admins who will monitor CTR and manage product mappings.​

# Goal of MVP

| KPI  | Target  |
| --- | --- |
| Time-to-first-results batch  | ≤ 2 s on 4 G  |
| Product-card completeness (title + image + link)  | ≥ 95 %  |
| Click-through rate (CTR)  | ≥ 12 % rolling 7-day avg on ≥ 100 outbound clicks  |

Out of Scope: image-only search, price-tracking alerts, in-app checkout, merchant dashboards.

# CORE FUNCTIONAL REQUIREMENTS

## 1 Authentication & Session

●​ Anonymous access by default.

●​ Optional email/password signup via Supabase Auth (future social OAuth stubbed but disabled).​

●​ Secure, HTTP-only JWT stored in SameSite=Lax cookies; 30-day rolling expiry.

●​ Guardrail: Any Settings "Save" requires authenticated session; otherwise prefs remain local-only.​

## 2 Interface & UX 

Area Desktop / Tablet  Mobile

Chat Pane  Fixed right (400 px)  Slide-up 

bottom-sheet 

Input  Text field + hold-to-talk mic  Same 

Product Grid 3–4 cols  2 cols 

Filters  Collapsible left rail Top drawer 

●

Global dark/light-mode switch.

●​ ⌘ / (or Ctrl /) focuses input; Enter (or mic release) submits.

●​ Focus & accessibility: Filter drawer traps focus, closes on backdrop click, ESC, or swipe-down (iOS).​

●​ Guardrail: Grid must not visually jank on network throttling—use skeleton loaders.

## 3 Functional Modules

**All modules below are implemented as Supabase Edge Functions.**

### 3.1 Query Capture 

type RawQuery = { 

 method: 'text' | 'voice', 

 content: string, // original user utterance

 ts: number   // epoch-ms 

}

### 3.2 GPT Parsing & Search

#### 1.​ GPT-4 → ParsedQuery​

○​ normalises phrasing​

○​ extracts candidate filters (brand, price, rating, shipping)

2.​ Send ParsedQuery.q to ChatGPT Web Search tool (≤ 10 URLs / batch; max 3 concurrent batches; exponential back-off on 429).​

3.​ Guardrail: Zero non-OpenAI HTTP calls—tool handles crawling.

### 3.3 Result Extraction (No-Scrape) 

type ProductItem = { 

 title: string,

 imageUrl: string | null, // Always rendered as an <img> in the UI; fallback only if null or broken

 link: string,  // direct product URL, no affiliate parameters

 price: string | null, // "&#36;199", "£45–£60" accepted

 rating: string | null, // "4.6/5"

 reviewCount: string | null,// "1 250 reviews" 

 whyBlurb: string   // ≤ 120 chars 

} 

●​ GPT-4 maps tool result objects to ProductItem.

●​ Missing imageUrl → fallback https://source.unsplash.com/featured/?shopping (or local placeholder.svg).​

●​ Deduplicate on canonical domain + slug.

### 3.4 Result Rendering 

●​ 20 cards per batch; IntersectionObserver triggers fetchNext().

●​ Card layout:​

1.​ image (16 : 9, object-fit: cover; always rendered as an <img> using imageUrl; fallback to placeholder only if imageUrl is null or fails to load)

2.​ title (2-line clamp, ≤ 60 chars)​

3.​ price (bold)

4.​ rating/reviewCount (star icon + text)​

5.​ whyBlurb​

6.​ Buy Now button → link (new tab).

●​ Guardrail: Scroll restoration on back-nav must return to last viewport position.

### 3.5 Voice I/O (Optional) 

●​ Input: Browser mic → ElevenLabs STT (env ELEVENLABS_STT_KEY) → RawQuery.

●​ Output: Toggle setting: speak top-3 results via ElevenLabs TTS (ELEVENLABS_TTS_KEY).​

●​ Latency: P95 STT ≤ 1 s; P95 TTS ≤ 1 s.

●​ Guardrail: If service > 1 s, abort voice playback and show silent results.

### 3.6 Affiliate Tagging 

**[REMOVED: No affiliate tagging or disclosure in this version.]**

## 4 Settings

●​ Filter prefs: priceRange(min,max), minRating, brands:string[], maxShipDays.

●​ Voice prefs: playback on/off, volume 0–1.​

●​ Anonymous → localStorage; signed-in → user_prefs table.

## 5 Admin Panel

●​ /admin (role-gated).

●​ Roles: admin (read-only), super_admin (CRUD).

●​ Read-only tables: users, queries, product_clicks.

●​ KPI widgets: daily active users, CTR, avg response ms.

●​ All admin actions logged to admin_actions table.

# NON-FUNCTIONAL REQUIREMENTS

## Security

●​ Adhere to OWASP Top 10.​

●​ Passwords bcrypt-hashed (≥ 12 rounds).

●​ Row-Level Security on all tables.

●​ Rate-limit: 50 req/min/IP (Supabase Edge Function middleware).

# Performance 

●​ FCP ≤ 2 s, TTI ≤ 3 s on Moto G4 / 4 G.

●​ P95 latency: Web Search ≤ 2 s; Voice STT/TTS ≤ 1 s; Render first 20 cards ≤ 500 ms.

●​ JS bundle ≤ 250 kB gzip; Lighthouse Performance ≥ 90.

●​ Edge-cache duplicate queries (shopwizz-cache:<md5>), TTL 15 min.

●​ Prefetch next batch in background while user reads current grid.

## Accessibility 

●​ WCAG 2.1 AA compliance.

●​ All images include programmatic alt; decorative images → alt="".

●​ Keyboard-navigable card focus states; ARIA labels on interactive elements.

Data Storage (Postgres via Supabase)

| Table  | Fields (PK ★)  |
| --- | --- |
| users  | id★, email, pw_hash, created_at  |
| queries  | id★, user_id FK∇, raw_text, parsed_text, filters jsonb, created_at  |
| products  | id★, query_id FK, title, image_url, link, price, rating, review_count, why_blurb |
| product_clicks  | id★, product_id FK, user_id FK∇, ts  |
| admin_action | id★, admin_id, action, target, ts |

∇ user_id = NULL when anonymous.

●​ Retention:

○​ queries, product_clicks → purge raw rows older than 365 days (aggregated nightly to daily_metrics).​

## TECH STACK

Layer  Technology

Frontend  Next.js 14 (App Router) $+$ TypeScript $+$  TailwindCSS

Backend Supabase (Auth, Postgres, Edge Functions)

AI Services OpenAI GPT-4, ChatGPT Web Search tool, ElevenLabs STT/TTS 

Monitoring Logflare (Supabase) $+$  Sentry JS SDK (error rat $e>2$ % alerts) 

Hosting  Vercel (FE) $\rightarrow$ Supabase (BE) $+$  Vercel Edge cache

# GUARDRAILS & PROCESS

1.​ DO NOT make external HTTP calls other than ChatGPT Web Search and ElevenLabs.

2.​ DO NOT rename field names, API routes, or DB schema without migration script & PM approval.​

3.​ DO NOT merge PRs unless Playwright e2e (anonymous search, filter update, voice input, click) pass $100\%$ .​

4.​ DO NOT store PII in logs; use hashed identifiers.

5.​ DO NOT release to production before security checklist sign-off and Lighthouse $\geq 90$ .

# MVP SUCCESS KPI

 100 weekly active users (WAU) generatin $g\geq 3$  searches each within 30 days of public beta (WAU $=$  unique user/guest with $\geq 1$  query in a 7-day window).​

●​ $\geq 5\%$  conversion to signup by day 30.

●​ P75 product-grid render time ≤ 1 s.

●​ $\text {CTR}\geq 12\%$  rolling 7-day avg on $N$ 100 clicks.

END OF PRD — DO NOT EDIT BELOW THIS LINE 

